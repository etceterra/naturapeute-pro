<!DOCTYPE html>
<meta charset="utf-8">
<title>Annuaire thérapeutes — Terrapeutes</title>

<meta name="description" value="Annuaire et réseau des thérapeutes en Suisse. Augmentez votre visibilité de thérapeute en partageant votre thérapie complémentaire ou alternative en Suisse.">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/polight/decor@master/decor.css">
<link rel="stylesheet" href="./assets/css/main.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">


<header class="row spaced">
  <h1>
    <a href="/"><img alt="Thérapeutes" src="//etceterra.github.io/terrapeutes-pro/assets/img/logo.png">
    pro</a>
  </h1>
  <!--
  <nav class=secondary>
    <a>Réseau de thérapeutes</a>
    <a>Adhérer au réseau</a>
    <a>Nous contacter</a>
  </nav> -->
</header>

<main>
  <section class=highlight>
    <h2><i class="fas fa-check-circle"></i> Bienvenue, vous êtes désormais inscrit•e !</h2>
    <p>
      Vous pouvez dès à présent compléter votre fiche ou le faire plus tard.<br>
      La confiance de vos clients dépend notamment de la qualité de votre fiche.
    </p>
  </section>

  <form method="post">
    <fieldset>
      <legend><i class="fas fa-map-marker-alt"></i> Adresse de votre établissement</legend>
      <input class=row type="text" name="street" placeholder="Rue et numéro" required>
        <div class="row">
        <input type="text" name="zipcode" placeholder="Code postal" required>
        <input type="text" name="city" placeholder="Ville" required>
      </div>
      <select class=row name=country disabled>
        <option value=ch>Suisse</option>
      </select>
    </fieldset>

    <fieldset>
      <legend><i class="fas fa-hands"></i> Votre méthode</legend>
        <textarea class=row name="introduction" placeholder="Votre approche et soins"></textarea>
        <textarea class=row name="certification" placeholder="Vos agréements, diplômes, certifications (ASCA, RME …)"></textarea>
      <input type=number name=price placeholder="Prix TTC par préstation (en CHF)">
      <textarea class=row name=timetable placeholder="Horaires d'ouverture"></textarea>
    </fieldset>

    <button class=primary>Enregistrer</button>
  </form>
</main>

<footer class=row>
  <p>
    <a href=http://terrapeutes.com>Terrapeutes</a> est un projet de <a href=http://www.mesurebienetre.com target=_blank>Mesure Bien Être</a>, SARL déposée en Suisse.
  </p>
  <div class=secondary>
    <a href="mailto:terrapeutes@protonmail.com">Nous contacter</a>
  </div>
</footer>

<script>

  document.querySelector('form').addEventListener('submit', (e) => {
    e.preventDefault()
    const fields = {}
    Array.from(e.currentTarget.elements).filter(e => e.name).forEach(e => (fields[e.name] =  e.value))
    fields.price = fields.price && Number(fields.price)
    fetch(`https://api.airtable.com/v0/app1Ab6PilgNTXMYp/Table%201/${location.search.split('=')[1]}`, {
      headers: {
        'Authorization': 'Bearer key7TSHb7BPpx1jts',
        'Content-Type': 'application/json',
      },
      method: 'patch',
      mode: 'cors',
      body: JSON.stringify({ fields })
    })
    .then((r) => r.json())
    .then((data) => {
      if(!data.id) return console.error(data)
      alert("Votre fiche est complétée, nous revenons vers vous dans les prochains jours.")
      location.href = '/'
    })
    .catch((e) => {
      console.error(e)
      alert("Une erreur est survenue. Veuillez vérifier les champs renseignés ou nous contacter.")
    })
  })
</script>

<style>
  form {
    margin: 3rem auto;
  }
  .hidden {
    display: none;
  }
</style>
